/**
 * p5play
 * @version 3.6
 * @author quinton-ashley
 * @license gpl-v3-only
 */
p5.prototype.registerMethod("init",(function(){if(void 0===window.planck)throw new Error("planck.js must be loaded before p5play");let t=this;const e=console.log;this.log=console.log;const i=planck;i.Settings.velocityThreshold=.19;let s=60;this.p5play=this.p5play||{},this.p5play.os??={emulated:!1},this.p5play.standardizeKeyboard??=!1,this.angleMode("degrees");const r=({x:t,y:e},r)=>new i.Vec2(t*r/s,e*r/s),o=(t,e)=>t*e/s,h=({x:t,y:e},r)=>new i.Vec2(t/r*s,e/r*s),n=t=>Math.abs(t-Math.round(t))<=i.Settings.linearSlop?Math.round(t):t;function a(t,e){return"triangle"==t?e=[e,-120,3]:"square"==t?e=[e,-90,4]:"pentagon"==t?e=[e,-72,5]:"hexagon"==t?e=[e,-60,6]:"septagon"==t?e=[e,-51.4285714286,7]:"octagon"==t?e=[e,-45,8]:"enneagon"==t?e=[e,-40,9]:"decagon"==t?e=[e,-36,10]:"hendecagon"==t?e=[e,-32.7272727273,11]:"dodecagon"==t&&(e=[e,-30,12]),e}let l=["autoDraw","autoUpdate","bounciness","collider","color","density","d","debug","diameter","direction","drag","dynamic","friction","fill","h","height","heading","isSuperFast","kinematic","layer","life","mass","resetAnimationsOnChange","rotation","rotationDrag","rotationLock","rotationSpeed","scale","shape","speed","static","stroke","strokeWeight","text","textColor","tileSize","visible","w","width","x","y"],p={_collisions:["_collides","_colliding","_collided"],_overlappers:["_overlaps","_overlapping","_overlapped"]};this.Sprite=class{constructor(e,s,r,o,h){this.p=t,this.idNum=this.p.world.spritesCreated,this.p.world.spritesCreated++;let p,u,c=[...arguments];if(void 0!==c[0]&&c[0]instanceof this.p.Group&&(p=c[0],c=c.slice(1)),c.length||(this._noArgs=!0),void 0!==c[0]&&isNaN(c[0])&&("string"==typeof c[0]||c[0]instanceof this.p.SpriteAnimation||c[0]instanceof p5.Image)&&(u=c[0],c=c.slice(1)),1==c.length&&"number"==typeof c[0])throw new w("Sprite",0,[c[0]]);if(e=c[0],s=c[1],r=c[2],o=c[3],h=c[4],this._originMode="center",Array.isArray(e)&&(e=void 0,s=void 0,r=c[0],o=c[1],h=c[2]),Array.isArray(r)||"string"==typeof o){if(isNaN(r)||(r=Number(r)),"number"!=typeof r&&Array.isArray(r[0])&&(this._originMode="start"),void 0!==o){if(Array.isArray(o))throw new w("Sprite",1,[`[[${r}], [${o}]]`]);!function(t){let e=t.slice(0,2);return"d"==t||"s"==t||"k"==t||"n"==t||"dy"==e||"st"==e||"ki"==e||"no"==e}(o)?r=a(o,r):h=o,o=void 0}}else isNaN(r)&&(h=r,r=void 0);if(this.groups=[],this.p.allSprites.push(this),this.animations={},this.removed=!1,p){if(p.push(this),!u)for(let t in p.animations){u=t;break}}else p=this.p.allSprites;p.dynamic&&(h??="dynamic"),p.kinematic&&(h??="kinematic"),p.static&&(h??="static"),h??=p.collider,this._shape=p.shape,this.life=1e8,this.visible=!0,this._collides={},this._colliding={},this._collided={},this._overlap={},this._overlaps={},this._overlapping={},this._overlapped={},this._collisions=new Map,this._overlappers=new Map,this.tileSize=p.tileSize||1;let f=this;if(this._pos={x:0,y:0},this._position={get x(){return f.x},set x(t){f.x=t},get y(){return f.y},set y(t){f.y=t}},this._vel={x:0,y:0},this._velocity=t.createVector.call(t),Object.defineProperty(this._velocity,"x",{get(){let t;return t=f.body?f.body.getLinearVelocity().x:f._vel.x,n(t/f.tileSize)},set(t){t*=f.tileSize,f.body?f.body.setLinearVelocity(new i.Vec2(t,f.body.getLinearVelocity().y)):f._vel.x=t}}),Object.defineProperty(this._velocity,"y",{get(){let t;return t=f.body?f.body.getLinearVelocity().y:f._vel.y,n(t/f.tileSize)},set(t){t*=f.tileSize,f.body?f.body.setLinearVelocity(new i.Vec2(f.body.getLinearVelocity().x,t)):f._vel.y=t}}),this._mirror={x:1,y:1},this.mirror={get x(){return f._mirror.x<0},set x(t){f._mirror.x=t?-1:1},get y(){return f._mirror.y<0},set y(t){f._mirror.y=t?-1:1}},this.layer=p.layer,this.layer??=this.p.allSprites.maxDepth()+1,h??=p.collider,h&&"string"==typeof h||(h="dynamic"),this.collider=h,e??=p.x,void 0===e&&(e=this.p.width/this.p.allSprites.tileSize/2,this._vertexMode=!0),s??=p.y,void 0===s&&(s=this.p.height/this.p.allSprites.tileSize/2),r??=p.w||p.width||p.diameter,o??=p.h||p.height,"function"==typeof e&&(e=e(p.length-1)),"function"==typeof s&&(s=s(p.length-1)),this.x=e,this.y=s,u){u instanceof p5.Image?this.addAni(u):"string"==typeof u?this._changeAni(u):this._animation=u.clone();let t=this.tileSize;r||1==this.ani.w&&1==this.ani.h||(r=this.ani.w/t,"circle"!=this.shape&&(o=this.ani.h/t))}this.mouse=new b,"none"!=this.collider?this._vertexMode?this.addCollider(r,o):this.addCollider(0,0,r,o):(this.w=r||(this.tileSize>1?1:50),this.h=o||this.w,this._shape=void 0!==r&&void 0===o?"circle":"box"),this._scale=new d,Object.defineProperty(this._scale,"x",{get(){return this._x},set(t){if(t==this._x)return;let e=t/this._x;f._w*=e,f._hw*=e,f._resizeCollider({x:e,y:1}),this._x=t,this._avg=.5*(this._x+this._y)}}),Object.defineProperty(this._scale,"y",{get(){return this._y},set(t){if(t==this._y)return;let e=t/this._y;f._h&&(this._h*=e,this._hh*=e),f._resizeCollider({x:1,y:e}),this._y=t,this._avg=.5*(this._x+this._y)}}),this.prevPos={x:e,y:s},this._dest={x:e,y:s},this._destIdx=0,this.drag=0,this.debug=!1,this._shift={};let g=p.vel.x||0,y=p.vel.y||0;"function"==typeof g&&(g=g(p.length-1)),"function"==typeof y&&(y=y(p.length-1)),this.vel.x=g,this.vel.y=y;for(let t of l){if("collider"==t||"x"==t||"y"==t)continue;let e=p[t];void 0!==e&&("function"==typeof e&&(e=e(p.length-1)),this[t]="object"==typeof e?Object.assign({},e):e)}for(let t of this.groups){let e={},i=Object.keys(t);for(let t of i)isNaN(t)&&"_"!=t[0]&&(e[t]=null);let s=["collider","idNum","p","parent","length","_collides","_colliding","_collided","_collisions","_overlap","_overlaps","_overlapping","_overlapped","_overlappers","animation","animations","autoCull","Sprite","GroupSprite","Group","SubGroup","vel","mirror","mouse"];for(let t of s)delete e[t];for(let i in e){let e=t[i];void 0!==e&&("function"==typeof e&&(/^(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*(?:(?:(?:async\s(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*)?function|class)(?:\s|(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*)|(?:[_$\w][\w0-9_$]*\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\()|(?:\[\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*(?:(?:['][^']+['])|(?:["][^"]+["]))\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\]\())/.test(e.toString())||(e=e())),this[i]="object"==typeof e?Object.assign({},e):e)}}this.strokeWeight,this.color??=this.p.color(this.p.random(30,245),this.p.random(30,245),this.p.random(30,245)),this.textColor??=this.p.color(0),this.textSize??=1==this.tileSize?this.p.canvas?this.p.textSize():12:.8;let m=!1;for(let t of this.groups)if(t._hasOverlaps){m=!0;break}m&&!this._hasOverlaps&&this._createSensors(),this._dimensionsUndefined=void 0===r&&void 0===o}addCollider(t,e,s,o){let h,n,l=[...arguments];l.length<3&&(t=0,e=0,s=l[0],o=l[1],this._vertexMode=!0),t??=0,e??=0,s??=this._w,!this.body&&this.shape&&"circle"!=this.shape&&(o??=this._h),Array.isArray(s)||"string"==typeof o?(isNaN(s)||(s=Number(s)),"number"!=typeof s&&Array.isArray(s[0])&&(this._originMode="start"),"string"==typeof o?(h=a(o,s),o=void 0):h=s):(void 0!==s&&void 0===o&&(n??="circle"),n??="box"),"box"!=n&&"circle"!=n||(s??=this.tileSize>1?1:50,o??=s);let p,d,u={};if("box"!=n&&"circle"!=n||(p=r({x:s-.08,y:o-.08},this.tileSize)),"box"==n)d=i.Box(p.x/2,p.y/2,r({x:t,y:e},this.tileSize),0);else if("circle"==n)d=i.Circle(r({x:t,y:e},this.tileSize),p.x/2);else if(h){let c,f,g=[{x:0,y:0}],y={x:0,y:0},m={x:0,y:0},_={x:0,y:0},w=Array.isArray(h[0]);function x(){y.x<m.x&&(m.x=y.x),y.y<m.y&&(m.y=y.y),y.x>_.x&&(_.x=y.x),y.y>_.y&&(_.y=y.y)}if(w){this._vertexMode&&(c=h[0][0],f=h[0][1],this.body?(c=this.x-this._relativeOrigin.x,f=this.y-this._relativeOrigin.y,g.pop()):(this.x=c,this.y=f));for(let b=0;b<h.length;b++){if(this._vertexMode){if(0==b&&!this.body)continue;y.x=h[b][0]-c,y.y=h[b][1]-f}else y.x+=h[b][0],y.y+=h[b][1];g.push({x:y.x,y:y.y}),x()}}else{let S=1;h.length%2&&(S=h[h.length-1]);let A=S>0?1:-1;S=Math.abs(S);let k=0;for(let C=0;C<S;C++){for(let z=0;z<h.length-1;z+=2){let T=h[z];k+=h[z+1],y.x+=T*this.p.cos(k),y.y+=T*this.p.sin(k),g.push({x:y.x,y:y.y}),x()}k*=A}}Math.abs(Math.abs(g[0].x)-Math.abs(g[g.length-1].x))<=i.Settings.linearSlop&&Math.abs(Math.abs(g[0].y)-Math.abs(g[g.length-1].y))<=i.Settings.linearSlop?(n="polygon",this._originMode="center"):n="chain",s=_.x-m.x,this._hw=.5*s,o=_.y-m.y,this._hh=.5*o;let v=!1;if("polygon"==n&&this._isConvexPoly(g.slice(0,-1))&&(v=!0),"start"==this._originMode)for(let F=0;F<g.length;F++)g[F]=r(g[F],this.tileSize);else{let M=0,D=0,I=0,O=0,P=g.length;("polygon"==n||v)&&P--;for(let N=0;N<P;N++)I+=g[N].x,O+=g[N].y;M=I/P,D=O/P,this.body||(this._relativeOrigin={x:M,y:D}),this._vertexMode&&w&&(this.body?(M=this._relativeOrigin.x,D=this._relativeOrigin.y):(this.x+=M,this.y+=D));for(let L=0;L<g.length;L++){let G=g[L];g[L]=r({x:G.x+t-M,y:G.y+e-D},this.tileSize)}}(!v||g.length-1>i.Settings.maxPolygonVertices||"chain"==this._shape)&&(n="chain"),"polygon"==n?d=i.Polygon(g):"chain"==n&&(d=i.Chain(g,!1),u.density=0,u.restitution=0)}u.shape=d,u.density??=this.density||5,u.friction??=this.friction||.5,u.restitution??=this.bounciness||.2,this.body||(this.body=this.p.world.createBody({position:r({x:this.x,y:this.y},this.tileSize),type:this.collider}),this.body.sprite=this),this._shape||(this._shape=n),this.body.createFixture(u),this._w=s,this._hw=.5*s,"circle"==n?this._diameter=s:(this._h=o,this._hh=.5*o)}_removeColliders(){this._collides={},this._colliding={},this._collided={},this._removeFixtures(!1)}addJoint(t,e,s){let h,n=this;return s??={},s.motorSpeed&&(s.enableMotor=!0),(s=Object.assign(s,{bodyA:n.body,bodyB:t.body,length:null!=s.length?o(s.length):null,maxLength:null!=s.maxLength?o(s.maxLength):null,lengthA:null!=s.lengthA?o(s.lengthA):null,lengthB:null!=s.lengthB?o(s.lengthB):null,groundAnchorA:s.groundAnchorA?o(s.groundAnchorA):new i.Vec2(0,0),groundAnchorB:s.groundAnchorB?o(s.groundAnchorB):new i.Vec2(0,0),upperTranslation:s.upperTranslation?o(s.upperTranslation):1,lowerTranslation:s.lowerTranslation?o(s.lowerTranslation):1,linearOffset:s.linearOffset?r(s.linearOffset):new i.Vec2(0,0)})).anchorA?s.localAnchorA=r(s.anchorA):s.localAnchorA?s.localAnchorA=r(s.localAnchorA):s.localAnchorA=new i.Vec2(0,0),s.anchorB?s.localAnchorB=r(s.anchorB):s.localAnchorB?s.localAnchorB=r(s.localAnchorB):s.localAnchorB=new i.Vec2(0,0),e??="distance","distance"==e?h=i.DistanceJoint(s):"orbit"==e||("pulley"==e?h=i.PulleyJoint(s):"wheel"==e?h=i.WheelJoint(s):"rope"==e?h=i.RopeJoint(s):"weld"==e?h=i.WeldJoint(s):"revolute"==e?h=i.RevoluteJoint(s,n.body,t.body,n.body.getWorldCenter()):"gear"==e?h=i.GearJoint(s):"friction"==e?h=i.FrictionJoint(s):"motor"==e?h=i.MotorJoint(s):"prismatic"==e&&(h=i.PrismaticJoint(s))),this.p.world.createJoint(h)}_removeSensors(){this._overlap={},this._overlaps={},this._overlapping={},this._overlapped={},this._removeFixtures(!0)}_removeFixtures(t){let e;for(let i=this.fixtureList;i;i=i.getNext())if(i.m_isSensor==t){let t=i.m_next;i.destroyProxies(this.p.world.m_broadPhase),e?e.m_next=t:this.body.m_fixtureList=t}else e=i}_cloneBodyProps(){let t={},e=[...l],i=["w","h","width","height","shape","d","diameter","dynamic","static","kinematic","collider","heading","direction"];for(let t of i){let i=e.indexOf(t);i>=0&&e.splice(i,1)}for(let i of e)t[i]=this[i];return t}get allowSleeping(){return this.body.getSleepingAllowed()}set allowSleeping(t){this.body.setSleepingAllowed(t)}get animation(){return this._animation}set animation(t){this.changeAni(t)}get ani(){return this._animation}set ani(t){this.changeAni(t)}get anis(){return this.animations}get bounciness(){if(this.fixture)return this.fixture.getRestitution()}set bounciness(t){for(let e=this.fixtureList;e;e=e.getNext())e.setRestitution(t)}get centerOfMass(){return h(this.body.getWorldCenter(),this.tileSize)}get collider(){return this._collider}set collider(t){let e=(t=t.toLowerCase())[0];if("d"==e&&(t="dynamic"),"s"==e&&(t="static"),"k"==e&&(t="kinematic"),"n"==e&&(t="none"),void 0===this._collider)return void(this._collider=t);if(t==this._collider)return;let i=this._collider;this._collider=t,void 0!==i&&this._reset()}_reset(){let t,e;if("none"!=this._collider&&(t=this._cloneBodyProps()),"chain"!=this._shape&&"polygon"!=this._shape||(e=this._getVertices(!0),this._vertexMode=!0),this.body&&(this.p.world.destroyBody(this.body),this.body=void 0),"none"!=this._collider){e?this.addCollider(0,0,e):this.addCollider(),this._hasOverlaps&&this._createSensors();for(let e in t)void 0!==t[e]&&(this[e]=t[e])}}_parseColor(t){if(t instanceof p5.Color)return t;if("object"!=typeof t)return"string"==typeof t&&1==t.length?this.p.colorPal(t):this.p.color(t);if(t.levels)return this.p.color(...t.levels);if(void 0!==t._r)return this.p.color(t._r,t._g,t._b,255*t._a);if(void 0!==t._h)return this.p.color(t._h,t._s,t._v,255*t._a);throw new Error("Invalid color")}get color(){return this._color}set color(t){this._color=this._parseColor(t)}get shapeColor(){return this._color}set shapeColor(t){this.color=t}get fill(){return this._color}set fill(t){this._color=this._parseColor(t)}get fillColor(){return this._color}set fillColor(t){this._color=this._parseColor(t)}get stroke(){return this._stroke}set stroke(t){this._stroke=this._parseColor(t)}get strokeColor(){return this._stroke}set strokeColor(t){this._stroke=this._parseColor(t)}get textColor(){return this._textColor}set textColor(t){this._textColor=this._parseColor(t)}get density(){if(this.fixture)return this.fixture.getDensity()}set density(t){for(let e=this.fixtureList;e;e=e.getNext())e.setDensity(t)}get depth(){return console.warn("sprite.depth is deprecated, use sprite.layer instead"),this.layer}set depth(t){console.warn("sprite.depth is deprecated, use sprite.layer instead"),this.layer=t}get direction(){return!this.body||0===this.vel.x&&0===this.vel.y?this._direction?this._direction:this.rotation:this.p.atan2(this.vel.y,this.vel.x)}set direction(t){if("string"==typeof t){this._heading=t;let e=t.toLowerCase().replaceAll(/[ _-]/g,"");t={up:-90,down:90,left:180,right:0,upright:-45,rightup:-45,upleft:-135,leftup:-135,downright:45,rightdown:45,downleft:135,leftdown:135,forward:this.rotation,backward:this.rotation+180}[e]}this._direction=t;let e=this.speed;this.vel.x=this.p.cos(t)*e,this.vel.y=this.p.sin(t)*e}get drag(){return this.body?this.body.getLinearDamping():1/0}set drag(t){this.body&&this.body.setLinearDamping(t)}get draw(){return this._display}set draw(t){this._draw=t}get dynamic(){if(this.body)return this.body.isDynamic()}set dynamic(t){t&&(this.collider="dynamic")}get rotationLock(){if(this.body)return this.body.isFixedRotation()}set rotationLock(t){this.body&&this.body.setFixedRotation(t)}get fixture(){return this.fixtureList}get fixtureList(){return this.body?this.body.getFixtureList():null}get friction(){if(this.fixture)return this.fixture.getFriction()}set friction(t){for(let e=this.fixtureList;e;e=e.getNext())e.setFriction(t)}get heading(){return this._heading}set heading(t){this.direction=t}get immovable(){return console.warn("sprite.immovable is deprecated, use sprite.static instead"),this.body.isStatic()}set immovable(t){console.warn("sprite.immovable is deprecated, use sprite.static instead"),t&&this.body.setStatic()}get img(){return this._animation.frameImage}set img(t){this.changeAni(t)}get image(){return this._animation.frameImage}set image(t){this.changeAni(t)}get isMoving(){return 0!=this.vel.x||0!=this.vel.y}get isSuperFast(){if(this.body)return this.body.isBullet()}set isSuperFast(t){this.body&&this.body.setBullet(t)}get kinematic(){if(this.body)return this.body.isKinematic()}set kinematic(t){t&&(this.collider="kinematic")}get mass(){if(this.body)return this.body.getMass()}set mass(t){if(!this.body)return;let e=this.massData;e.mass=t,this.body.setMassData(e)}get massData(){const t={I:0,center:new i.Vec2(0,0),mass:0};return this.body.getMassData(t),t.center=h(t.center,this.tileSize),t}get previousPosition(){return this.prevPos}set previousPosition(t){this.prevPos=t}get rotation(){return this.body?"degrees"===this.p._angleMode?this.p.degrees(this.body.getAngle()):this.body.getAngle():this._angle||0}set rotation(t){this.body?"degrees"===this.p._angleMode?this.body.setAngle(this.p.radians(t)):this.body.setAngle(t):this._angle=t}get rotationDrag(){if(this.body)return this.body.getAngularDamping()}set rotationDrag(t){this.body&&this.body.setAngularDamping(t)}get rotationSpeed(){return this.body?this.body.getAngularVelocity():this._rotationSpeed||0}set rotationSpeed(t){this.body?this.body.setAngularVelocity(t):this._rotationSpeed=t}get scale(){return this._scale}set scale(t){if(t<=0&&(t=.01),"number"==typeof t&&(t={x:t,y:t}),t.x==this._scale._x&&t.y==this._scale._y)return;let e={x:t.x/this._scale._x,y:t.y/this._scale._y};this._w*=e.x,this._hw*=e.x,this._h&&(this._h*=e.y,this._hh*=e.y),this._resizeCollider(e),this._scale._x=t.x,this._scale._y=t.y,this._scale._avg=t.x}get sleeping(){if(this.body)return!this.body.isAwake()}set sleeping(t){this.body&&this.body.setAwake(!t)}getSpeed(){return console.warn("getSpeed() is deprecated, use sprite.speed instead"),this.speed}get speed(){return this.p.createVector(this.vel.x,this.vel.y).mag()}set speed(t){let e=this.direction;this.vel.x=this.p.cos(e)*t,this.vel.y=this.p.sin(e)*t}get static(){if(this.body)return this.body.isStatic()}set static(t){t&&(this.collider="static")}get vertices(){return this._getVertices()}_getVertices(e){let i=this.fixture;for(;i.m_next;)i=i.m_next;let r=i.getShape(),o=[...r.m_vertices];"polygon"==r.m_type&&o.unshift(o.at(-1));let h=this.x,a=this.y;for(let i=0;i<o.length;i++){let r=[n(o[i].x/this.tileSize*s+h),n(o[i].y/this.tileSize*s+a)];o[i]=e?r:t.createVector(r[0],r[1])}return o}get x(){if(!this.body)return this._pos.x;let t=this.body.getPosition().x/this.tileSize*s;return n(t)}set x(t){if(this.body){let e=new i.Vec2(t*this.tileSize/s,this.body.getPosition().y);this.body.setPosition(e)}this._pos.x=t}get y(){if(!this.body)return this._pos.y;let t=this.body.getPosition().y/this.tileSize*s;return n(t)}set y(t){if(this.body){let e=new i.Vec2(this.body.getPosition().x,t*this.tileSize/s);this.body.setPosition(e)}this._pos.y=t}set pos(t){let e=new i.Vec2(t.x*this.tileSize/s,t.y*this.tileSize/s);_this.body.setPosition(e)}get w(){return this._w}set w(t){if(t<0&&(t=.01),t==this._w)return;this._dimensionsUndefined=!1;let e=t/this._w;this._w=t,this._hw=.5*t,this._resizeCollider({x:e,y:1})}get hw(){return this._hw}set hw(t){throw new w("Sprite.hw")}get width(){return this.w}set width(t){this.w=t}get halfWidth(){return this.hw}set halfWidth(t){throw new w("Sprite.hw")}get h(){return"circle"==this.shape?this._w:this._h}set h(t){if(t<0&&(t=.01),"circle"==this.shape)return void(this.w=t);if(t==this._h)return;this._dimensionsUndefined=!1;let e=t/this._h;this._h=t,this._hh=.5*t,this._resizeCollider({x:1,y:e})}get hh(){return this._hh||this._hw}set hh(t){throw new w("Sprite.hh")}get height(){return this.h}set height(t){this.h=t}get halfHeight(){return this.hh}set halfHeight(t){throw new w("Sprite.hh")}get d(){return this._diameter??=this.w,this._diameter}set d(t){if(t<0)return void this.remove();let e="circle"!=this.shape;if(e){let e;if("none"==this._collider&&(e=this._cloneBodyProps()),this._removeSensors(),this._removeColliders(),this._h=void 0,this._shape=void 0,"none"!=this._collider){this.addCollider(0,0,t);for(let t in e)void 0!==e[t]&&(this[t]=e[t])}this._shape="circle"}else{if(this._diameter==t)return;this._diameter=t}let i=t/this._w;this._w=t,this._hw=.5*t,this._h=t,this._hh=this._hw,e||this._resizeCollider({x:i,y:i})}get diameter(){return this.d}set diameter(t){this.d=t}get r(){return this._hw}set r(t){this.d=2*t}get radius(){return this._hw}set radius(t){this.d=2*t}_resizeCollider(t){if(this.body){if("circle"==this.shape){this.fixture.m_shape.m_radius*=t.x}else for(let e=this.fixtureList;e;e=e.getNext()){if(e.m_isSensor)continue;let i=e.m_shape;for(let e of i.m_vertices)e.x*=t.x,e.y*=t.y}"static"==this.collider&&this.body.synchronizeFixtures()}}_isConvexPoly(t){t:for(let e=0;e<2;e++){1==e&&(t=t.reverse());for(let s=0;s<t.length;++s){const r=s,o=s<t.length-1?r+1:0,h=t[r],n=i.Vec2.sub(t[o],h);for(let s=0;s<t.length;++s){if(s==r||s==o)continue;const a=i.Vec2.sub(t[s],h);if(i.Vec2.cross(n,a)<0){if(0==e)continue t;return!1}}}break}return!0}get shape(){return this._shape}set shape(t){if(t==this._shape)return;let e=["box","circle","chain","polygon"];if(-1==e.indexOf(t))throw new Error('Invalid shape type: "'+t+'"\nThe valid shape types are: "'+e.join('", "')+'"');"circle"==t?this.d=this.w:(this._shape=t,this._reset())}get update(){return this._update}set update(t){this._customUpdate=t}get pos(){return this._position}set pos(t){this.x=t.x,this.y=t.y}get position(){return this._position}set position(t){this.pos=t}get vel(){return this._velocity}set vel(t){this.vel.x=t.x,this.vel.y=t.y}set velocity(t){this.vel=t}get velocity(){return this._velocity}_update(){this.animation&&this.animation.update();for(let t in this.mouse)-1==this.mouse[t]&&(this.mouse[t]=0);this._customUpdate&&this._customUpdate(),this.autoUpdate&&(this.autoUpdate=null)}_step(){if(!this.body)return this.rotation+=this._rotationSpeed,this.x+=this.vel.x,void(this.y+=this.vel.y);let t=this;for(let e in p)for(let i of this[e]){let s,r=i[0],o=i[1]+1;if(this[e].set(r,o),0==o){this[e].delete(r);continue}if(s=-1==o?p[e][2]:1==o?p[e][0]:p[e][1],r instanceof this.p.Group)continue;let h=this.p.world._findContactCB(s,t,r);"function"==typeof h&&h(t,r,o)}}_draw(){if(void 0!==this.strokeWeight&&this.p.strokeWeight(this.strokeWeight),this.animation&&!this.debug)this.animation.draw(0,0,0,this._scale.x,this._scale.y);else if(null!=this.fixture){"chain"==this._shape?this.p.stroke(this.stroke||this.color):this._stroke&&this.p.stroke(this._stroke);for(let t=this.fixtureList;t;t=t.getNext())this._drawFixture(t)}else this.p.stroke(this._stroke||120),"box"==this._shape?this.p.rect(0,0,this.w*this.tileSize,this.h*this.tileSize):"circle"==this._shape&&this.p.circle(0,0,this.d*this.tileSize);void 0!==this.text&&(this.p.textAlign(this.p.CENTER,this.p.CENTER),this.p.fill(this.textColor),this.p.textSize(this.textSize*this.tileSize),this.p.text(this.text,0,0))}_display(){let t=.5*this.p.width-this.p.world.origin.x+this.x*this.tileSize,e=.5*this.p.height-this.p.world.origin.y+this.y*this.tileSize;"chain"!=this.shape&&this.p.camera.active&&(t+this.w<this.p.camera.bound.min.x||t-this.w>this.p.camera.bound.max.x||e+this.h<this.p.camera.bound.min.y||e-this.h>this.p.camera.bound.max.y)||(t=n(t),t-=this.w*this.tileSize%2?.5:0,e=n(e),e-=this.h*this.tileSize%2?.5:0,this.p.push(),this.p.imageMode("center"),this.p.rectMode("center"),this.p.ellipseMode("center"),this.p.translate(t,e),this.rotation&&this.p.rotate(this.rotation),this.p.scale(this._mirror.x,this._mirror.y),this.p.fill(this.color),this._draw(),this.p.pop(),this._cameraActiveWhenDrawn=this.p.camera.active,this.autoDraw&&(this.autoDraw=null))}_drawFixture(t){const e=t.m_shape;if("polygon"==e.m_type||"chain"==e.m_type){"chain"==e.m_type&&(this.p.push(),this.p.noFill());let t=e.m_vertices;this.p.beginShape();for(let e=0;e<t.length;e++)this.p.vertex(t[e].x*s,t[e].y*s);"chain"!=e.m_type?this.p.endShape("close"):(this.p.endShape(),this.p.pop())}else if("circle"==e.m_type){const t=2*e.m_radius*s;this.p.ellipse(e.m_p.x*s,e.m_p.y*s,t,t)}else"edge"==e.m_type&&this.p.line(e.m_vertex1.x*s,e.m_vertex1.y*s,e.m_vertex2.x*s,e.m_vertex2.y*s)}_args2Vec(t,e){return Array.isArray(t)?{x:t[0],y:t[1]}:("object"==typeof t&&(e=t.y,t=t.x),{x:t||0,y:e||0})}applyForce(t,e,s,o){if(!this.body||!t&&!e)return;2==arguments.length&&"number"!=typeof e&&(s=e);let h=new i.Vec2(this._args2Vec(t,e));if(h=h.mul(this.body.m_mass),s||o){let t=r(this._args2Vec(s,o),this.tileSize);this.body.applyForce(h,t,!1)}else this.body.applyForceToCenter(h,!1)}applyImpulse(t,e,s,o){if(!this.body)return;2==arguments.length&&"number"!=typeof e&&(s=e);let h,n=new i.Vec2(this._args2Vec(t,e));h=void 0===s?this.body.getPosition():r(this._args2Vec(s,o),this.tileSize),this.body.applyLinearImpulse(n,h,!0)}applyTorque(t){this.body.applyTorque(t,!0)}setVelocity(t,e){console.warn("setVelocity() is deprecated. Set sprite.vel instead."),"object"==typeof t&&(e=t.y,t=t.x),this.vel.x=t,this.vel.y=e}setSpeed(t,e){console.warn("setSpeed is deprecated. Set sprite.direction and sprite.speed separately instead."),e&&(this.direction=e),this.speed=t}addSpeed(t,e){e??=this.direction,this.vel.x+=this.p.cos(e)*t,this.vel.y+=this.p.sin(e)*t}moveTowards(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;if(void 0===s.x||void 0===s.y)return void console.error("sprite.moveTowards/moveAway ERROR: movement destination not defined, object given with no x or y properties");i=e,e=s.y,t=s.x}void 0===t&&void 0===e||(i??=.1,null!=t&&(this.vel.x=(t-this.x)*i*this.tileSize),null!=e&&(this.vel.y=(e-this.y)*i*this.tileSize))}moveAway(t,e,i){this.moveTowards(...arguments),this.vel.x*=-1,this.vel.y*=-1}move(t,e,i){let s=isNaN(arguments[0]);s?(e=arguments[0],i=arguments[1],void 0!==(t=arguments[2])&&console.warn("In p5play v3.3.0 the parameter ordering for the move() function was changed to: move(distance, direction, speed).")):s=isNaN(e),void 0!==e&&(this.direction=e),t??=1;let r=this.x+this.p.cos(this.direction)*t,o=this.y+this.p.sin(this.direction)*t;return s&&(r=Math.round(r),o=Math.round(o)),this.moveTo(r,o,i)}moveTo(e,i,s){if(void 0===e)return void console.error("sprite.move ERROR: movement direction or destination not defined");if("number"!=typeof e){let t=e;if(t==this.p.mouse&&!this.p.mouse.active)return;if(void 0===t.x||void 0===t.y)return void console.error("sprite.moveTo ERROR: movement destination not defined, object given with no x or y properties");s=i,i=t.y,e=t.x}this._dest.x=this.x,this._dest.y=this.y;if(e==this.x?e=!1:(this._dest.x=e,e=!0),i==this.y?i=!1:(this._dest.y=i,i=!0),this._destIdx++,!e&&!i)return!0;if(this.speed&&(s??=this.speed),this.tileSize>1&&(s??=.1),s??=1,s<=0)return void console.warn("sprite.move: speed should be a positive number");let r=this._dest.y-this.y,o=this._dest.x-this.x,h=Math.sqrt(r*r+o*o),n=s/h;this.vel.x=o*n,this.vel.y=r*n;let a=Math.floor(h/s)-5,l=s+.01,p=this._destIdx;return(async()=>{let s=l+l,r=l+l;do{if(p!=this._destIdx)return!1;await t.delay(),a>0?a--:(s=Math.abs(this.x-this._dest.x),r=Math.abs(this.y-this._dest.y))}while(e&&s>l||i&&r>l);return s<l&&(this.x=this._dest.x),r<l&&(this.y=this._dest.y),this.vel.x=0,this.vel.y=0,!0})()}attractionPoint(t,e,i){console.warn("sprite.attractionPoint is deprecated, use sprite.moveTowards instead");let s=this.p.atan2(i-this.y,e-this.x);this.vel.x+=this.p.cos(s)*t,this.vel.y+=this.p.sin(s)*t}snap(t,e){!t.isMoving&&t.x==t._dest.x&&t.y==t._dest.y&&this.isMoving&&(e??=1,Math.abs(this.x)%1>=e||Math.abs(this.y)%1>=e||(this.vel.x=0,this.vel.y=0,this.x=Math.round(this.x),this.y=Math.round(this.y)))}rotateTowards(t,e,i,s){"number"!=typeof t&&(s=i,i=e,e=s);let r=this.angleTo(t,e,s);i??=.1,this.rotationSpeed=r*i}angleTo(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return 0;if(void 0===s.x||void 0===s.y)return console.error("sprite.angleTo ERROR: rotation destination not defined, object given with no x or y properties"),0;i=e,e=s.y,t=s.x}if(Math.abs(t-this.x)<.01&&Math.abs(e-this.y)<.01)return 0;i??=0;let s=this.p.atan2(e-this.y,t-this.x)+i-this.rotation%360,r=360-Math.abs(s);return r*=s<0?1:-1,Math.abs(s)<Math.abs(r)?s:r}rotateTo(t,e,i,s){"number"!=typeof t&&(s=i,i=e,e=s);let r=this.angleTo(t,e,s);return this.rotate(r,i)}rotate(e,i){if(isNaN(e))throw new w;if(0==e)return;let s=Math.abs(e);i??=1,i>s&&(i=s);let r=this.rotation+e,o=e>0;this.rotationSpeed=i*(o?1:-1);let h=Math.ceil(s/i);this._rotateIdx??=0,this._rotateIdx++;let n=this._rotateIdx;return(async()=>{if(h>1){for(;h>0;){if(this._rotateIdx!=n)return;await t.delay(),h--}for(;Math.abs(this.rotationSpeed)<Math.abs(r-this.rotation);)await t.delay();Math.abs(r-this.rotation)>.01&&(this.rotationSpeed=r-this.rotation,await t.delay())}else await t.delay();this.rotationSpeed=0,this.rotation=r})()}async changeAni(t){t=t instanceof this.p.SpriteAnimation?[t]:[...arguments];let e=(t,e,i)=>new Promise((s=>{this._changeAni(t),e<0&&(e=this._animation.length+e),e&&(this._animation.frame=e),void 0!==i?this._animation.goToFrame(i):this.frame==this.lastFrame&&s(),this._animation.onComplete=()=>{s()}}));for(let e=0;e<t.length;e++){let i=t[e];(i instanceof this.p.SpriteAnimation||i instanceof p5.Image||"string"==typeof i&&1!=i.length&&i.includes("."))&&(i=this.addAni(i),t[e]=i),"string"==typeof i&&(i={name:i},t[e]=i),"!"==i.name[0]&&(i.name=i.name.slice(1),i.start=-1,i.end=0)}for(let i=0;i<t.length;i++){let s=t[i],{name:r,start:o,end:h}=s;await e(r,o,h)}}changeAnimation(){return this.changeAni(...arguments)}_changeAni(t){let e=this.animations[t];if(!e)for(let i=this.groups.length-1;i>=0;i--){if(e=this.groups[i].animations[t],e){e=e.clone();break}}if(!e)throw this.p.noLoop(),new w("Sprite.changeAnimation",[t]);this._animation=e,this.animation.name=t,this.resetAnimationsOnChange&&(this.animation.frame=0)}remove(){for(this.body&&this.p.world.destroyBody(this.body),this.body=null,this.removed=!0;this.groups.length>0;)this.groups[0].remove(this)}toString(){return"s"+this.idNum}_ensureCollide(t,e){if(!t)throw new w("Sprite.collide",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new w("Sprite.collide",0,[t]);if(e&&"function"!=typeof e)throw new w("Sprite.collide",1,[e])}collide(t,e){return this.collides(t,e)}collides(t,e){return this._ensureCollide(t,e),this._collides[t]=e||!0,1==this._collisions.get(t)}colliding(t,e){this._ensureCollide(t,e),this._colliding[t]=e||!0;let i=this._collisions.get(t);return i>0?i:0}collided(t,e){return this._ensureCollide(t,e),this._collided[t]=e||!0,-1==this._collisions.get(t)}_ensureOverlap(t,e){if(!t)throw new w("Sprite.overlap",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new w("Sprite.overlap",0,[t]);if(e&&"function"!=typeof e)throw new w("Sprite.overlap",1,[e]);if(this._hasOverlaps||this._createSensors(),t instanceof this.p.Sprite)t._hasOverlaps||t._createSensors();else if(t instanceof this.p.Group&&!t._hasOverlaps){for(let e of t)e._hasOverlaps||e._createSensors();t._hasOverlaps=!0}this._overlap[t]=!0}overlap(t,e){return this.overlaps(t,e)}overlaps(t,e){return this._ensureOverlap(t,e),this._overlaps[t]=e||!0,1==this._overlappers.get(t)}overlapping(t,e){this._ensureOverlap(t,e),this._overlapping[t]=e||!0;let i=this._overlappers.get(t);return i>0?i:0}overlapped(t,e){return this._ensureOverlap(t,e),this._overlapped[t]=e||!0,-1==this._overlappers.get(t)}_createSensors(){let t;for(let e=this.fixtureList;e;e=e.getNext())t=e.m_shape,this.body.createFixture({shape:t,isSensor:!0});this._hasOverlaps=!0}getAnimationLabel(){return console.warn("sprite.getAnimationLabel is deprecated. Use sprite.animation.name instead."),this.animation.name}},this.Turtle=function(e){if(t.allSprites.tileSize>1)throw new Error("Turtle can't be used when allSprites.tileSize is greater than 1.");e??=25;let i=new t.Sprite(e,e,[[e,.4*e],[-e,.4*e],[0,.8*-e]]);i.color="green",i._isTurtleSprite=!0,i._prevPos={x:i.x,y:i.y};let s=i.move;return i.move=async function(){this._prevPos.x=this.x,this._prevPos.y=this.y,await s.call(this,...arguments)},i},this.SpriteAnimation=class extends Array{constructor(){super(),this.p=t;let e,i=[...arguments];if(this.name="default",(i[0]instanceof this.p.Sprite||i[0]instanceof this.p.Group)&&(e=i[0],i=i.slice(1)),e??=this.p.allSprites,"string"!=typeof i[0]||1!=i[0].length&&i[0].includes(".")||(this.name=i[0],i=i.slice(1)),this.frame=0,this.cycles=0,this.targetFrame=-1,this.offset={x:0,y:0},this._frameDelay=4,this.playing=!0,this.visible=!0,this.looping=!0,this.endOnFirstFrame=!1,this.frameChanged=!1,this.rotation=0,this._scale=new d,0!=i.length&&"number"!=typeof i[0])if(e.addAni(this),Array.isArray(i[0])&&"string"==typeof i[0][0]&&(i=[...i[0]]),2!=i.length||"string"!=typeof i[0]||"string"!=typeof i[1]&&"number"!=typeof i[1])if("string"==typeof i[i.length-1]||i[i.length-1]instanceof p5.Image)for(let s=0;s<i.length;s++)i[s]instanceof p5.Image?this.push(i[s]):this.push(this.p.loadImage(i[s]));else{let r,o=e.spriteSheet;if(i[0]instanceof p5.Image||"string"==typeof i[0]){if(i.length>=3)throw new w("SpriteAnimation",1);o=i[0],r=i[1]}else r=i[0];let h=this;if(o instanceof p5.Image&&1!=o.width&&1!=o.height)this.spriteSheet=o,n();else{let a;a="string"==typeof o?o:o.url,this.spriteSheet=this.p.loadImage(a,(()=>{n()}))}function n(){if(Array.isArray(r)||Array.isArray(r.frames)){if("number"!=typeof r[0]){let t=r;if(Array.isArray(r.frames)){t=r.frames,delete r.frames;for(let e=0;e<t.length;e++)t[e]={pos:t[e]},Object.assign(t[e],r)}for(let e of t)r=e,n();return}r=4==r.length?{pos:r.slice(0,2),size:r.slice(2)}:{pos:r}}let t,{w:i,h:s,width:o,height:a,frameSize:l,size:p,pos:d,line:u,x:c,y:f,frames:g,delay:y,rotation:m}=r;p??=l,y&&(h.frameDelay=y),m&&(h.rotation=m),i??=o,s??=a,e&&(i??=e.w,s??=e.h,t=e.tileSize),c??=0,f??=0,d??=u,"number"==typeof d?f=d:d&&(c=d[0],f=d[1]),"number"==typeof p?i=s=p:p&&(i=p[0],s=p[1]),c*=t,f*=t,i&&s?(i*=t,s*=t):i=s=t?1*t:h.spriteSheet.width<h.spriteSheet.height?h.spriteSheet.width:h.spriteSheet.height;let _=g||1;for(let t=0;t<_;t++)h.push({x:c,y:f,w:i,h:s}),c+=i,c>=h.spriteSheet.width&&(c=0,f+=s,f>=h.spriteSheet.height&&(f=0))}}else{let l,p,u=i[0];if(isNaN(i[1])?l=i[1]:p=Number(i[1]),".png"!=u.slice(-4)||l&&".png"!=l.slice(-4))throw new w("SpriteAnimation",0,[u]);let c=0,f=0;for(let m=u.length-5;m>=0&&!isNaN(u.charAt(m));m--)c++;if(l)for(let _=l.length-5;_>=0&&!isNaN(l.charAt(_));_--)f++;let g,y=u.slice(0,-4-c);if(l&&(g=l.slice(0,-4-f)),l&&y!=g)this.push(this.p.loadImage(u)),this.push(this.p.loadImage(l));else{let x,v=parseInt(u.slice(-4-c,-4),10);if(p??=parseInt(l.slice(-4-f,-4),10),p<v){let b=p;p=v,v=b}if(l&&c!=f)for(let S=v;S<=p;S++)x=y+S+".png",this.push(this.p.loadImage(x));else for(let A=v;A<=p;A++)x=y+this.p.nf(A,c)+".png",this.push(this.p.loadImage(x))}}}get frameDelay(){return this._frameDelay}set frameDelay(t){t<=0&&(t=1),this._frameDelay=t}get scale(){return this._scale}set scale(t){"number"==typeof t&&(t={x:t,y:t}),this._scale._x=t.x,this._scale._y=t.y,this._scale._avg=t.x}clone(){let t=new this.p.SpriteAnimation;t.spriteSheet=this.spriteSheet;for(let e=0;e<this.length;e++)t.push(this[e]);return t.offset.x=this.offset.x,t.offset.y=this.offset.y,t.frameDelay=this.frameDelay,t.playing=this.playing,t.looping=this.looping,t.rotation=this.rotation,t}draw(t,i,s,r,o){if(this.x=t||0,this.y=i||0,!this.visible)return;r??=1,o??=1,this.p.push(),this.p.imageMode("center"),this.p.translate(this.x,this.y),this.p.rotate(s||this.rotation),this.p.scale(r*this._scale.x,o*this._scale.y);let h=this[this.frame];if(void 0!==h)if(this.spriteSheet){let{x:t,y:e,w:i,h:s}=h;this.p.image(this.spriteSheet,this.offset.x,this.offset.y,i,s,t,e,i,s)}else this.p.image(h,this.offset.x,this.offset.y);else e("Warning: "+this.name+" animation not loaded yet or frame "+this.frame+" does not exist. Load this animation in the p5.js preload function if you need to use it at the start of your program.");this.p.pop()}update(){this.cycles++;this.frame;if(this.frameChanged=!1,1===this.length&&(this.playing=!1,this.frame=0),this.playing&&this.cycles%this.frameDelay==0){if(this.frameChanged=!0,(-1==this.targetFrame&&this.frame==this.lastFrame||this.frame==this.targetFrame)&&(this.endOnFirstFrame&&(this.frame=0),this.looping?this.targetFrame=-1:this.playing=!1,this.onComplete(),!this.looping))return;this.targetFrame>this.frame&&-1!==this.targetFrame?this.frame++:this.targetFrame<this.frame&&-1!==this.targetFrame?this.frame--:this.targetFrame===this.frame&&-1!==this.targetFrame?this.playing=!1:this.looping?this.frame>=this.lastFrame?this.frame=0:this.frame++:this.frame<this.lastFrame&&this.frame++}}play(t){return this.playing=!0,void 0!==t&&(this.frame=t),this.targetFrame=-1,new Promise((t=>{this.onComplete=()=>{t()}}))}pause(t){this.playing=!1,t&&(this.frame=t)}stop(t){this.playing=!1,t&&(this.frame=t)}rewind(){return this.looping=!1,this.goToFrame(0)}loop(){this.looping=!0,this.playing=!0}noLoop(){this.looping=!1}onComplete(){}changeFrame(t){console.warn("Deprecated, change the ani.frame property directly."),t<this.length?this.frame=t:this.frame=this.length-1,this.targetFrame=-1}nextFrame(){this.frame<this.length-1?this.frame=this.frame+1:this.looping&&(this.frame=0),this.targetFrame=-1,this.playing=!1}previousFrame(){this.frame>0?this.frame=this.frame-1:this.looping&&(this.frame=this.length-1),this.targetFrame=-1,this.playing=!1}goToFrame(t){if(!(t<0||t>=this.length))return this.targetFrame=t,this.targetFrame!==this.frame&&(this.playing=!0),new Promise((t=>{this.onComplete=()=>{t()}}))}getFrame(){return console.warn("Deprecated, use ani.frame instead."),this.frame}getLastFrame(){return console.warn("Deprecated, use ani.lastFrame instead."),this.lastFrame}get lastFrame(){return this.length-1}get frameImage(){let t=this[this.frame];if(t instanceof p5.Image)return t;let{x:e,y:i,w:s,h:r}=t,o=createGraphics(s,r);return o.image(this.spriteSheet,this.offset.x,this.offset.y,s,r,e,i,s,r),o}get w(){return this.width}get width(){return this[this.frame]instanceof p5.Image?this[this.frame].width:this[this.frame]?this[this.frame].w:1}get h(){return this.height}get height(){return this[this.frame]instanceof p5.Image?this[this.frame].height:this[this.frame]?this[this.frame].h:1}get frames(){let t=[];for(let e=0;e<this.length;e++)t.push(this[e]);return t}get images(){return this.frames}},this.Group=class extends Array{constructor(...e){let i;if(e[0]instanceof t.Group&&(i=e[0],e=e.slice(1)),super(...e),this.idNum=0,this.p=t,"number"==typeof e[0])return;for(let t of this)if(!(t instanceof this.p.Sprite))throw new Error("A group can only contain sprites");this.p.allSprites||(this._isAllSpritesGroup=!0),this._isAllSpritesGroup||(this.parent=0),i&&(this.parent=i.idNum),this.animations={},this._collides={},this._colliding={},this._collided={},this._overlap={},this._overlaps={},this._overlapping={},this._overlapped={},this._collisions=new Map,this._overlappers=new Map,this.p.world&&(this.idNum=this.p.world.groupsCreated,this.p.world.groups[this.idNum]=this,this.p.world.groupsCreated++);let s=this;class r extends this.p.Sprite{constructor(){super(s,...arguments)}}this.GroupSprite=r,this.Sprite=r;class o extends this.p.Group{constructor(){super(s,...arguments)}}this.SubGroup=o,this.Group=o,this.mouse={presses:null,pressing:null,pressed:null,holds:null,holding:null,held:null,released:null,hovers:null,hovering:null,hovered:null};for(let t in this.mouse)this.mouse[t]=function(e){for(let i of s)if(i.mouse[t](e))return!0;return!1};let h=[...l,"spriteSheet"];for(let t of h)Object.defineProperty(this,t,{get(){let e=s["_"+t],i=s.length-1;if(void 0===e&&this.p.world&&!s._isAllSpritesGroup){let r=this.p.world.groups[s.parent];r&&(e=r[t],i=r.length-1)}return e},set(e){s["_"+t]=e;for(let i=0;i<s.length;i++){let r=s[i],o=e;"function"==typeof e&&(o=e(i)),r[t]=o}}});this.vel=t.createVector.call(t),this.mirror={};let n={vel:["x","y"],mirror:["x","y"]};for(let t in n)for(let e of n[t])Object.defineProperty(this[t],e,{get(){let i=s[t]["_"+e],r=s.length-1;if(void 0===i&&s.p.world&&!s._isAllSpritesGroup){let o=s.p.world.groups[s.parent];o&&(i=o[t][e],r=o.length-1)}return i},set(i){s[t]["_"+e]=i;for(let r=0;r<s.length;r++){let o=s[r],h=i;"function"==typeof i&&(h=i(r)),o[t][e]=h}}});this._orbitAngle=0,this._isAllSpritesGroup&&(this.autoCull=!0,this.tileSize=1),this.autoDraw=!0,this.autoUpdate=!0}get ani(){return this._animation}set ani(t){this.addAni(t);for(let e of this)e.changeAni(t)}get animation(){return this._animation}set animation(t){this.ani=t}get anis(){return this.animations}get img(){return this._animation.frameImage}set img(t){this.ani=t}get image(){return this._animation.frameImage}set image(t){this.ani=t}set amount(t){let e=t-this.length,i=e>0;e=Math.abs(e);for(let t=0;t<e;t++)i?this.add(new this.Sprite):this[this.length-1].remove()}resetCentroid(){let t=0,e=0;for(let i of this)t+=i.x,e+=i.y;return this.centroid={x:t/this.length,y:e/this.length},this.centroid}resetDistancesFromCentroid(){for(let t of this)t.distCentroid={x:t.x-this.centroid.x,y:t.y-this.centroid.y}}snap(t,e){e??=1;for(let i of this)i.snap(t,e)}_ensureCollide(t,e){if(!t)throw new w("Group.collide",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new w("Group.collide",0,[t]);if(e&&"function"!=typeof e)throw new w("Group.collide",1,[e])}collide(t,e){return this.collides(t,e)}collides(t,e){return this._ensureCollide(t,e),this._collides[t]=e||!0,1==this._collisions.get(t)}colliding(t,e){this._ensureCollide(t,e),this._colliding[t]=e||!0;let i=this._collisions.get(t);return i>0?i:0}collided(t,e){return this._ensureCollide(t,e),this._collided[t]=e||!0,-1==this._collisions.get(t)}_ensureOverlap(t,e){if(!t)throw new w("Group.overlap",2);if(!(t instanceof this.p.Sprite||t instanceof this.p.Group))throw new w("Group.overlap",0,[t]);if(e&&"function"!=typeof e)throw new w("Group.overlap",1,[e]);if(!this._hasOverlaps){for(let t of this)t._hasOverlaps||t._createSensors();this._hasOverlaps=!0}if(t instanceof this.p.Sprite)t._hasOverlaps||t._createSensors();else if(t instanceof this.p.Group&&!t._hasOverlaps){for(let e of t)e._hasOverlaps||e._createSensors();t._hasOverlaps=!0}this._overlap[t]=!0}overlap(t,e){return this.overlaps(t,e)}overlaps(t,e){return this._ensureOverlap(t,e),this._overlaps[t]=e||!0,1==this._overlappers.get(t)}overlapping(t,e){this._ensureOverlap(t,e),this._overlapping[t]=e||!0;let i=this._overlappers.get(t);return i>0?i:0}overlapped(t,e){return this._ensureOverlap(t,e),this._overlapped[t]=e||!0,-1==this._overlappers.get(t)}applyForce(t,e){for(let i of this)i.applyForce(t,e)}move(t,e,i){let s=[];for(let r of this)s.push(r.move(t,e,i));return Promise.all(s)}moveTo(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;i=e,e=s.y,t=s.x}let s=this.resetCentroid(),r=[];for(let o of this){let h={x:o.x-s.x+t,y:o.y-s.y+e};r.push(o.moveTo(h.x,h.y,i))}return Promise.all(r)}moveTowards(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;i=e,e=s.y,t=s.x}if(void 0!==t||void 0!==e){this.resetCentroid();for(let s of this){void 0===s.distCentroid&&this.resetDistancesFromCentroid();let r={x:s.distCentroid.x+t,y:s.distCentroid.y+e};s.moveTowards(r.x,r.y,i)}}}moveAway(t,e,i){if("number"!=typeof t){let s=t;if(s==this.p.mouse&&!this.p.mouse.active)return;i=e,e=s.y,t=s.x}if(void 0!==t||void 0!==e){this.resetCentroid();for(let s of this){void 0===s.distCentroid&&this.resetDistancesFromCentroid();let r={x:s.distCentroid.x+t,y:s.distCentroid.y+e};s.moveAway(r.x,r.y,i)}}}orbit(t){0==this.p.frameCount&&console.warn("group.orbit is experimental and is subject to change in the future!"),this.centroid||this.resetCentroid(),this._orbitAngle+=t;let e=this._orbitAngle;for(let t of this){void 0===t.distCentroid&&this.resetDistancesFromCentroid();let i=t.distCentroid.x,s=t.distCentroid.y,r=i*this.p.cos(e)-s*this.p.sin(e),o=i*this.p.sin(e)+s*this.p.cos(e);r+=this.centroid.x,o+=this.centroid.y,t.vel.x=.1*(r-t.x)*t.tileSize,t.vel.y=.1*(o-t.y)*t.tileSize}}get(t){return console.warn("Deprecated: use group[i] instead of group.get(i)"),this[t]}contains(t){return console.warn("Deprecated: use group.includes(sprite) instead of group.contains(sprite)"),this.indexOf(t)>-1}push(t){if(!(t instanceof this.p.Sprite))throw new Error("you can only add sprites to a group");if(-1==this.indexOf(t))return super.push(t),this.parent&&this.p.world.groups[this.parent].push(t),t.groups.push(this),!0}add(t){this.push(t)}size(){return this.length}toString(){return"g"+this.idNum}cull(t,e,i,s,r){if(void 0===i){r=e,t=e=i=s=t}if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(s))throw new TypeError("The culling boundary must be defined with numbers");if(r&&"function"!=typeof r)throw new TypeError("The callback to group.cull must be a function");let o=this.p.camera.x-this.p.world.hw/this.p.camera.zoom,h=this.p.camera.y-this.p.world.hh/this.p.camera.zoom,n=-i+o,a=-t+h,l=this.p.width+s+o,p=this.p.height+e+h,d=0;for(let t of this)(t.x<n||t.y<a||t.x>l||t.y>p)&&(d++,r?r(t,d):t.remove());return d}remove(t){if(void 0===t){for(;this.length>0;)this[0].remove();return}let e;if("number"==typeof t)e=t;else for(let i=this.length-1;i>=0;i--)if(this[i]===t){e=i;break}if(void 0!==e){let t=this[e],i=this[e].groups.findIndex((t=>t.idNum==this.idNum));return this[e].groups.splice(i,1),this.splice(e,1),t}throw new Error("Sprite not found in group")}removeAll(){this.remove()}maxDepth(){if(0==this.length)return 0;if(1==this.length&&void 0===this[0].layer)return 0;let t=this[0].layer;for(let e of this)e.layer>t&&(t=e.layer);return t}minDepth(){return 0===this.length?99999:this.reduce((function(t,e){return Math.min(t,e.depth)}),1/0)}draw(){let t=[...this];t.sort(((t,e)=>t.layer-e.layer));for(let e=0;e<t.length;e++){let i=t[e];i.life--<0?(i.remove(),t.splice(e,1),e--):!i.visible||this.p.p5play._inPostDraw&&!i.autoDraw||i.draw()}this._autoDraw&&(this._autoDraw=null)}update(){for(let t of this)this.p.p5play._inPostDraw&&!this.autoUpdate||t.update();this._autoUpdate&&(this._autoUpdate=null)}_step(){for(let t of this)t._step()}},this.Sprite.prototype.addAnimation=this.Group.prototype.addAnimation=this.Sprite.prototype.addAni=this.Group.prototype.addAni=this.Sprite.prototype.addImage=this.Group.prototype.addImage=this.Sprite.prototype.addImg=this.Group.prototype.addImg=function(){let t,e,i=[...arguments];return i[0]instanceof this.p.SpriteAnimation?(e=i[0],t=e.name||"default",e.name=t):i[1]instanceof this.p.SpriteAnimation?(t=i[0],e=i[1],e.name=t):(e=new this.p.SpriteAnimation(this,...i),t=e.name),this.animations[t]=e,this._animation=e,!this._dimensionsUndefined||1==e.w&&1==e.h||(this.w=e.w,this.h=e.h),e},this.Sprite.prototype.addAnis=this.Group.prototype.addAnis=this.Sprite.prototype.addAnimations=this.Group.prototype.addAnimations=this.Sprite.prototype.addImages=this.Group.prototype.addImages=this.Sprite.prototype.addImgs=this.Group.prototype.addImgs=function(){let t,e=arguments;1==e.length?t=e[0]:(this.spriteSheet=e[0],t=e[1]);for(let e in t){let i=t[e];this.addAni(e,i)}},this.World=class extends i.World{constructor(){super(new i.Vec2(0,0),!0),this.p=t,this.width=this.p.width,this.height=this.p.height,this._offset={x:0,y:0};let e=this;this.offset={get x(){return-e._offset.x},set x(t){e._offset.x=t,e.resize()},get y(){return-e._offset.y},set y(t){e._offset.y=t,e.resize()}},this.resize(),this.groups=[this.p.allSprites],this.groupsCreated=1,this.spritesCreated=0,this.contacts=[],this.on("begin-contact",this._beginContact),this.on("end-contact",this._endContact),this.gravity={get x(){return e.m_gravity.x},set x(t){for(let t of e.p.allSprites)t.sleeping=!1;e.m_gravity.x=e.p.round(t||0)},get y(){return e.m_gravity.y},set y(t){for(let t of e.p.allSprites)t.sleeping=!1;e.m_gravity.y=e.p.round(t||0)}},this.mouseTracking??=!0,this.mouseSprite=null,this.mouseSprites=[],this.autoStep=!0}resize(t,e){t??=this.p.width,e??=this.p.height,this.origin={x:.5*t+this.offset.x,y:.5*e+this.offset.y},1!=this.p.allSprites.tileSize&&(this.origin.x-=.5*this.p.allSprites.tileSize,this.origin.y-=.5*this.p.allSprites.tileSize),this.hw=.5*t,this.hh=.5*e}step(t,e,i){for(let t of this.p.allSprites)t.prevPos.x=t.x,t.prevPos.y=t.y;super.step(t||1/(this.p._targetFrameRate||60),e||8,i||3),this.p.allSprites._step(),this.autoStep&&(this.autoStep=null)}getSpritesAt(t,e,r,o){o??=!0;const h=new i.Vec2(t/s,e/s),n=new i.AABB;n.lowerBound=new i.Vec2(h.x-.001,h.y-.001),n.upperBound=new i.Vec2(h.x+.001,h.y+.001);let a=[];this.queryAABB(n,(t=>(t.getShape().testPoint(t.getBody().getTransform(),h)&&a.push(t),!0))),r??=this.p.allSprites;let l=[];if(a.length>0)for(let t of r)t.body&&a.includes(t.body.m_fixtureList)&&t._cameraActiveWhenDrawn==o&&l.push(t);return l}getSpriteAt(t,e,i){let s=this.getSpritesAt(t,e,i);return s.sort(((t,e)=>-1*(t.layer-e.layer))),s[0]}_beginContact(t){let e=t.m_fixtureA,i=t.m_fixtureB,s="_collisions";e.isSensor()&&(s="_overlappers"),e=e.m_body.sprite,i=i.m_body.sprite,e[s].set(i,0),i[s].set(e,0);for(let t of i.groups)t[s].set(e,t[s].get(e)||0),e[s].set(t,e[s].get(t)||0);for(let t of e.groups){t[s].set(i,t[s].get(i)||0),i[s].set(t,i[s].get(t)||0);for(let e of i.groups)t[s].set(e,t[s].get(e)||0),e[s].set(t,e[s].get(t)||0)}}_endContact(t){let e=t.m_fixtureA,i=t.m_fixtureB,s="_collisions";e.isSensor()&&(s="_overlappers"),e=e.m_body.sprite,i=i.m_body.sprite,e[s].set(i,-2),i[s].set(e,-2);for(let t of i.groups){let i=!1;for(let r of t)if(r[s].get(e)>=0){i=!0;break}i||(t[s].set(e,-2),e[s].set(t,-2))}for(let t of e.groups){let e=!1;for(let r of t)if(r[s].get(i)>=0){e=!0;break}if(!e){t[s].set(i,-2),i[s].set(t,-2);for(let e of i.groups)t[s].set(e,-2),e[s].set(t,-2)}}}_findContactCB(t,e,i){let s=e[t][i];if(s)return s;let r=i instanceof this.p.Sprite;if(r)for(let r of i.groups)if(s=e[t][r],s)return s;if(e instanceof this.p.Sprite)for(let o of e.groups){if(s=o[t][i],s)return s;if(r)for(let e of i.groups)if(s=o[t][e],s)return s}return!1}get allowSleeping(){return this.getAllowSleeping()}set allowSleeping(t){this.setAllowSleeping(t)}},this.Camera=class{constructor(e,i,s){this.p=t;this._pos={x:0,y:0},this.zoom=s||1,this.mouse={x:this.p.mouseX,y:this.p.mouseY},this.active=!1,this.bound={min:{x:0,y:0},max:{x:0,y:0}},e&&(this.x=e),i&&(this.y=i)}get pos(){return this._pos}get position(){return this._pos}get x(){return this._pos.x}set x(t){this._pos.x=t,this.bound.min.x=this.x-this.p.world.hw/this.zoom-100,this.bound.max.x=this.x+this.p.world.hw/this.zoom+100}get y(){return this._pos.y}set y(t){this._pos.y=t,this.bound.min.y=this.y-this.p.world.hh/this.zoom-100,this.bound.max.y=this.y+this.p.world.hh/this.zoom+100}on(){this.active||(this.p.push(),this.p.scale(this.zoom),this.p.translate(-this.x+this.p.world.hw/this.zoom,-this.y+this.p.world.hh/this.zoom),this.active=!0)}off(){this.active&&(this.p.pop(),this.active=!1)}},i.Fixture.prototype.shouldCollide=function(t){let e=this,i=t;if(e.isSensor()&&i.isSensor())return!0;if(e.isSensor()||i.isSensor())return!1;e=e.m_body.sprite,i=i.m_body.sprite;let s=e.p.world._findContactCB("_overlap",e,i);return s||(s=e.p.world._findContactCB("_overlap",i,e)),!s};this.Tiles=class{constructor(e,i,s,r,o){"string"==typeof e&&(e=e.split("\n")),i??=0,s??=0,r??=1,o??=1;for(let h=0;h<e.length;h++)for(let n=0;n<e[h].length;n++){let a,l,p=e[h][n];if(" "==p||"."==p)continue;for(l of t.world.groups)if(a=l.animations[p],a)break;if(a){new l.Sprite(a,i+n*r,s+h*o);continue}let d,u=!1;for(l of t.world.groups)if(l.tile==p){u=!0;break}if(u)new l.Sprite(i+n*r,s+h*o);else{for(d of t.allSprites)if(d.tile==p){u=!0;break}u?(d.x=i+n*r,d.y=s+h*o):console.error("Tile not found: "+p)}}}},this.createTiles=function(t,e,i,s,r){return new this.Tiles(t,e,i,s,r)};class d{constructor(){this._x=1,this._y=1,this._avg=1}valueOf(){return this._avg}get x(){return this._x}set x(t){t!=this._x&&(this._x=t,this._avg=.5*(this._x+this._y))}get y(){return this._y}set y(t){t!=this._y&&(this._y=t,this._avg=.5*(this._x+this._y))}}this.updateSprites=function(){1==this.frameCount&&console.warn("updateSprites() is deprecated, use world.step() instead."),this.world.step(...arguments),this.allSprites.update()},this.getSpritesAt=function(){return this.world.getSpritesAt(...arguments)},this.getSpriteAt=function(){return this.world.getSpriteAt(...arguments)},this.p5play.palettes??=[{a:"aqua",b:"black",c:"crimson",d:"dark blue",f:"fuchsia",g:"green",h:"hot pink",i:"blue",k:"black",l:"lavender",m:"magenta",n:"brown",o:"orange",p:"pink",r:"red",s:"sky blue",t:"turquoise",u:"blue",v:"violet",w:"white",y:"yellow"}],this.colorPal=(e,i)=>{if(e instanceof p5.Color)return e;let s;return"number"==typeof i&&(i=t.p5play.palettes[i]),i??=t.p5play.palettes[0],i&&(s=i[e]),""===s||"."===e||" "===e?t.color(0,0,0,0):t.color(s||e)},this.spriteArt=(e,i,s)=>{i??=1,"number"==typeof s&&(s=t.p5play.palettes[s]),s??=t.p5play.palettes[0];let r=e;"string"==typeof e&&(r=(e=(e=(e=e.trim()).replace(/\r*\n\t+/g,"\n")).replace(/\s+$/g,"")).split("\n"));let o=0;for(let t of r)t.length>o&&(o=t.length);let h=r.length,n=t.createImage(o*i,h*i);n.loadPixels();for(let t=0;t<r.length;t++)for(let e=0;e<r[t].length;e++)for(let o=0;o<i;o++)for(let h=0;h<i;h++){let a=this.colorPal(r[t][e],s);n.set(e*i+o,t*i+h,a)}return n.updatePixels(),n.w=n.width,n.h=n.height,t.p5play.images.onLoad(n),n},this.drawSprite=function(t){1==this.frameCount&&console.warn("drawSprite() is deprecated, use sprite.draw() instead."),t.draw()},this.drawSprites=function(t){1==this.frameCount&&console.warn("drawSprites() is deprecated, use group.draw() instead."),t??=this.allSprites,t.draw()},this.createSprite=function(){return new this.Sprite(...arguments)},this.createGroup=function(){return new this.Group(...arguments)},this.loadAni=this.loadAnimation=function(){return new this.SpriteAnimation(...arguments)},this.animation=function(t,e,i,s,r,o){t.visible&&t.update(),t.draw(e,i,s,r,o)},this.delay=t=>new Promise(t?e=>{setTimeout(e,t)}:requestAnimationFrame),this.sleep=t=>this.delay(t),this.play=t=>{if(!t.play)throw new Error("Tried to play a sound but the sound is not a sound object: "+t);return new Promise(((e,i)=>{t.play(),t.onended((()=>e()))}))};let u=p5.disableFriendlyErrors;p5.disableFriendlyErrors=!0;const c=this.createCanvas;this.createCanvas=function(){let e,i,s,r=[...arguments],o=!1,h=!1;if("string"==typeof r[0]&&(s=r[0].split(":"),"fullscreen"==r[1]&&(o=!0)),r.length?"number"==typeof r[0]&&"number"!=typeof r[1]&&(r[2]=r[1],r[1]=r[0]):(r[0]=window.innerWidth,r[1]=window.innerHeight,o=!0),"pixelated"==r[2]&&(h=!0,o=!0,s=[r[0],r[1]]),s){let t=Number(s[0]),o=Number(s[1]);e=window.innerWidth,i=window.innerWidth*(o/t),i>window.innerHeight&&(e=window.innerHeight*(t/o),i=window.innerHeight),e=Math.round(e),i=Math.round(i),h||(r[0]=e,r[1]=i)}r.length<3&&(r[2]="p2d");let n=c.call(t,...r);this.canvas.tabIndex=0,this.canvas.addEventListener("keydown",(function(t){" "!=t.key&&"/"!=t.key&&"ArrowUp"!=t.key&&"ArrowDown"!=t.key&&"ArrowLeft"!=t.key&&"ArrowRight"!=t.key||t.preventDefault()})),this.canvas.addEventListener("mouseover",(()=>{this.mouse.isOnCanvas=!0,this.mouse.active=!0})),this.canvas.addEventListener("mouseleave",(()=>{this.mouse.isOnCanvas=!1})),this.canvas.addEventListener("touchstart",(t=>{t.preventDefault()})),this.world.resize(),u||(p5.disableFriendlyErrors=!1);let a="\ncanvas { \n\toutline: none;\n\t-webkit-touch-callout: none;\n\t-webkit-text-size-adjust: none;\n\t-webkit-user-select: none;\n\toverscroll-behavior: none;\n}\nmain{\n\toverscroll-behavior: none;\n}";o&&(a="html,\nbody,\n"+a,a+="\nhtml, body {\n\tmargin: 0;\n\tpadding: 0;\n\toverflow: hidden;\n}\nmain {\n\tmargin: auto;\n\tdisplay: flex;\n\talign-content: center;\n\tjustify-content: center;\n}"),h&&(a+=`\ncanvas {\n\timage-rendering: pixelated;\n\twidth: ${e}px!important;\n\theight: ${i}px!important;\n}`);let l=document.createElement("style");l.innerHTML=a,document.head.appendChild(l),h&&(t.pixelDensity(1),t.noSmooth());let p=navigator.userAgent.indexOf("iPhone OS");if(p>-1){let e=navigator.userAgent.substring(p+10,p+12);this.p5play.version=e,e<16&&t.pixelDensity(1),this.p5play.os.platform="iOS",this.p5play.os.version=e}else void 0!==navigator.userAgentData&&(this.p5play.os.platform=navigator.userAgentData.platform);return n},this.Canvas=function(){return t.createCanvas(...arguments)};const f=this.background;this.background=function(){let t,e=arguments;1==e.length&&("string"==typeof e[0]||e[0]instanceof p5.Color)&&(t=this.colorPal(e[0])),void 0!==t?f.call(this,t):f.call(this,...e)};const g=this.fill;this.fill=function(){let t,e=arguments;1==e.length&&(t=this.colorPal(e[0])),void 0!==t?g.call(this,t):g.call(this,...e)};const y=this.stroke;this.stroke=function(){let t,e=arguments;1==e.length&&(t=this.colorPal(e[0])),void 0!==t?y.call(this,t):y.call(this,...e)},this.p5play.images={onLoad:t=>{}};const m=this.loadImage;this.loadImg=this.loadImage=function(){let e,i=arguments,s=i[0],r=t.p5play.images[s];if("function"==typeof i[i.length-1]&&(e=i[i.length-1]),r)return 1==r.width&&1==r.height||!r.pixels.length?e?(r.cbs.push(e),r.calls++):t._decrementPreload():(e&&e(),t._decrementPreload()),r;return r=m.call(t,s,(e=>{e.w=e.width,e.h=e.height;for(let t of e.cbs)t();for(let i=1;i<e.calls;i++)t._decrementPreload();e.cbs=[],t.p5play.images.onLoad(r)})),r.cbs=[],r.calls=1,e&&r.cbs.push(e),r.url=s,t.p5play.images[s]=r,r};let _={generic:["Ah! I found an error","Oh no! Something went wrong","Oof! Something went wrong","Houston, we have a problem","Whoops, having trouble here"],Sprite:{constructor:{base:"Sorry I'm unable to make a new Sprite",0:"What is $0 for? If you're trying to specify the x position of the sprite, please specify the y position as well.",1:"If you're trying to specify points for a chain Sprite, please use an array of position arrays:\n$0"},hw:"I can't change the halfWidth of a Sprite directly, change the sprite's width instead.",hh:"I can't change the halfHeight of a Sprite directly, change the sprite's height instead.",rotate:"The angle of rotation must be a number.",changeAnimation:'I can\'t find any animation named "$0".',collide:{0:"I can't make that sprite collide with $0. Sprites can only collide with another sprite or a group.",1:"The collision callback has to be a function.",2:"You're trying to check for an collision with a sprite or group that doesn't exist!"},overlap:{0:"I can't make that sprite overlap with $0. Sprites can only overlap with another sprite or a group.",1:"The overlap callback has to be a function.",2:"You're trying to check for an overlap with a sprite or group that doesn't exist!"}},SpriteAnimation:{constructor:{base:"Hey so, I tried to make a new SpriteAnimation but couldn't",0:'I don\'t know how to display this type of image: "$0". I can only use ".png" image files.',1:"The name of the animation must be the first input parameter."}},Group:{constructor:{base:"Hmm awkward! Well it seems I can't make that new Group you wanted"}}};_.Group.collide=_.Sprite.collide,_.Group.overlap=_.Sprite.overlap;class w extends Error{constructor(t,e,i){super(),"string"!=typeof t&&(i=e,e=t,t=(t=this.stack.match(/\n\s*at ([^\(]*)/)[1]).slice(0,-1)),"number"!=typeof e&&(i=e,e=void 0),"new"==t.slice(0,3)&&(t=t.slice(4));let s=(t=t.split("."))[0];t=t[1]||"constructor";let r=this.stack.match(/\/([^p\/][^5][^\/:]*:[^\/:]+):/);r?(r=r[1].split(":"),r=" in "+r[0]+" at line "+r[1]+". "):r=".",i=i||[];let o,h=_[s][t];o=h.base?h.base+r:_.generic[Math.floor(Math.random()*_.generic.length)]+r,void 0!==e&&(h=h[e]),h=h.replace(/\$([0-9]+)/g,((t,e)=>i[e])),o+=h,p5._friendlyError(o,t)}}this.allSprites=new this.Group,this.world=new this.World,this.frame=0,this.camera=new this.Camera;class x{constructor(){this.holdThreshold=12}init(t){for(let e of t)this[e]=0}ac(t){return t}presses(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),1==this[t]||-2==this[t]}pressing(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),-2==this[t]?1:this[t]>0?this[t]:0}pressed(t){return this.released(t)}holds(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),this[t]==this.holdThreshold}holding(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),this[t]>=this.holdThreshold?this[t]:0}held(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),-3==this[t]}released(t){return t??=this.default,void 0===this[t]&&(t=this.ac(t)),this[t]<=-1}releases(t){return this.released(t)}}class v extends x{constructor(){super();let t=this;this._position={get x(){return t.x},set x(e){t.x=e},get y(){return t.y},set y(e){t.y=e}};this.init(["x","y","left","center","right"]),this.default="left",this.draggable=!1,this.isOnCanvas=!1,this.active=!1,this.x,this.y}get pos(){return this._position}get position(){return this._position}ac(t){return t=t.slice(0,4)?"left":"right"==t.slice(0,5)?"right":"middle"==t.slice(0,6)?"center":t.toLowerCase()}dragging(t){return t??=this.default,this.draggable=!0,this[t]>=this.holdThreshold?this[t]:0}}this.mouse=new v;class b extends v{constructor(){super(),this.hover=0}hovers(){return 1==this.hover}hovering(){return this.hover>0?this.hover:0}hovered(){return-1==this.hover}}const S=this._onmousedown,A=function(t){let e;this.mouse[t]++,this.mouse.active=!0,this.world.mouseSprites.length&&(e=this.world.mouseSprites[0],e.mouse[t]=1,this.world.mouseSprite&&(this.world.mouseSprite.mouse[t]=0,"left"==t&&(this.world.mouseSprite.mouse.draggable=!1)),this.world.mouseSprite=e)};this._onmousedown=function(t){let e="left";1===t.button?e="center":2===t.button&&(e="right"),A.call(this,e),S.call(this,t)};const k=this._ontouchstart;this._ontouchstart=function(t){A.call(this,"left"),k.call(this,t)};const C=this._onmouseup,z=function(t){this.mouse[t]>=this.mouse.holdThreshold?this.mouse[t]=-3:this.mouse[t]>1?this.mouse[t]=-1:this.mouse[t]=-2,this.world.mouseSprite&&(this.world.mouseSprite.mouse.hover>1?this.world.mouseSprite.mouse[t]>=this.mouse.holdThreshold?this.world.mouseSprite.mouse[t]=-3:this.world.mouseSprite.mouse[t]>1?this.world.mouseSprite.mouse[t]=-1:this.world.mouseSprite.mouse[t]=-2:(this.world.mouseSprite.mouse[t]=0,this.world.mouseSprite.mouse.draggable=!1))};this._onmouseup=function(t){let e="left";1===t.button?e="center":2===t.button&&(e="right"),z.call(this,e),C.call(this,t)};const T=this._ontouchend;this._ontouchend=function(t){z.call(this,"left"),T.call(this,t)};if(this.kb=new class extends x{constructor(){super(),this.default=" "}ac(t){if(1==t.length)return t.toLowerCase();if(!isNaN(t)){if(38==t)return"ArrowUp";if(40==t)return"ArrowDown";if(37==t)return"ArrowLeft";if(39==t)return"ArrowRight";throw new Error('Use key names with the keyboard input functions, not key codes! If you are trying to detect if the user pressed a number key make it a string. For example: "5"')}return"space"==t||"spacebar"==t?" ":t[0].toUpperCase()+t.slice(1).toLowerCase()}get space(){return this[" "]}get spacebar(){return this[" "]}},this.keyboard=this.kb,navigator.keyboard){const t=navigator.keyboard;window==window.top?t.getLayoutMap().then((t=>{"w"!=t.get("KeyW")&&(this.p5play.standardizeKeyboard=!0)})):this.p5play.standardizeKeyboard=!0}else this.p5play.standardizeKeyboard=!0;function F(t){let e=t.code;return 4==e.length&&"Key"==e.slice(0,3)?e[3].toLowerCase():t.key}this.keyIsDown=function(t){throw new Error("The p5.js keyIsDown function is outdated and can't be used in p5play. Trust me, you'll see that the p5play kb.pressing function is much better. It uses key name strings that are easier to write and easier to read! https://p5play.org/learn/input_devices.html The p5.js keyIsDown function relies on key codes and custom constants for key codes, which are not only hard to remember but were also deprecated in the JavaScript language standards over six years ago and shouldn't be used in new projects. More info: https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode")};let M={w:"up",s:"down",a:"left",d:"right",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",i:"up2",k:"down2",j:"left2",l:"right2"};const D=this._onkeydown;this._onkeydown=function(t){let e=t.key;this.p5play.standardizeKeyboard&&(e=F(t));let i=[e],s=M[e];s&&i.push(s);for(let t of i)(!this.kb[t]||this.kb[t]<0)&&(this.kb[t]=1);D.call(this,t)};const I=this._onkeyup;this._onkeyup=function(t){let e=t.key;this.p5play.standardizeKeyboard&&(e=F(t));let i=[e],s=M[e];s&&i.push(s);for(let t of i)this.kb[t]>=this.kb.holdThreshold?this.kb[t]=-3:this.kb[t]>1?this.kb[t]=-1:this.kb[t]=-2;I.call(this,t)};class O extends x{constructor(t){super();this.init(["a","b","x","y","l","r","lt","rt","select","start","up","down","left","right","leftTrigger","rightTrigger"]),this.leftStick={x:0,y:0,btn:0},this.rightStick={x:0,y:0,btn:0},this._btns={a:0,b:1,x:2,y:3,l:4,r:5,lt:6,rt:7,select:8,start:9,leftStickButton:10,rightStickButton:11,up:12,down:13,left:14,right:15},this._axes={leftStick:{x:0,y:1},rightStick:{x:2,y:3},leftTrigger:4,rightTrigger:5},t.id.includes("GuliKit")&&(this._btns.a=1,this._btns.b=0,this._btns.x=3,this._btns.y=2),e(t),this.gamepad=t,this.id=t.id}ac(t){return t.toLowerCase()}_update(){if(this.gamepad=navigator.getGamepads()[this.gamepad.index],!this.gamepad)return;let t=this.gamepad;for(let e in this._btns){let i=this._btns[e];t.buttons[i].pressed?this[e]++:this[e]=0}return this.leftStick.x=t.axes[this._axes.leftStick.x],this.leftStick.y=t.axes[this._axes.leftStick.y],this.rightStick.x=t.axes[this._axes.rightStick.x],this.rightStick.y=t.axes[this._axes.rightStick.y],void 0!==t.axes[this._axes.leftTrigger]?(this.leftTrigger=t.axes[this._axes.leftTrigger],this.rightTrigger=t.axes[this._axes.rightTrigger]):(this.leftTrigger=t.buttons[this._btns.lt].value,this.rightTrigger=t.buttons[this._btns.rt].value),!0}}this.contro=new class extends Array{constructor(){super();let t=this;window.addEventListener("gamepadconnected",(e=>{t._addContro(e.gamepad)})),this.default="a";let e=["presses","pressing","pressed","holds","holding","held","released"];for(let t of e)this[t]=e=>{if(this[0])return this[0][t](e)};let i=["a","b","x","y","l","r","lt","rt","select","start","leftStickButton","rightStickButton","up","down","left","right"];for(let e of i)Object.defineProperty(this,e,{get:()=>t[0]?t[0][e]:0});let s=["leftStick","rightStick"];for(let e of s){this[e]={};for(let i of["x","y"])Object.defineProperty(this[e],i,{get:()=>t[0]?t[0][e][i]:0})}if(!navigator?.getGamepads)return;let r=navigator.getGamepads();for(let t of r)t&&this._addContro(t)}_addContro(t){t&&(e("controller "+this.length+" connected: "+t.id),this.push(new O(t)))}_update(){for(let t of this)t._update()}},this.controllers=this.contro,this.getFPS||(this.p5play._fps=60),this.getFPS??=()=>this.p5play._fps})),p5.prototype.registerMethod("pre",(function(){this.p5play._fps&&(this.p5play._preDrawFrameTime=performance.now()),1==this.frameCount&&(this.camera.x=this.world.hw,this.camera.y=this.world.hh,this.camera.init=!0,this.canvas.addEventListener("contextmenu",(t=>t.preventDefault()))),this.mouse.x=(this.mouseX-this.world.hw)/this.camera.zoom+this.camera.x,this.mouse.y=(this.mouseY-this.world.hh)/this.camera.zoom+this.camera.y,this.camera.mouse.x=this.mouseX,this.camera.mouse.y=this.mouseY,this.contro._update()})),p5.prototype.registerMethod("post",(function(){this.p5play._inPostDraw=!0,this.frame=this.frameCount,this.allSprites.autoCull&&this.allSprites.cull(1e4),this.allSprites._autoDraw&&(this.camera.on(),this.allSprites.draw(),this.camera.off()),null===this.allSprites._autoDraw&&(this.allSprites._autoDraw=!0),this.world.autoStep&&this.world.step(),null===this.world.autoStep&&(this.world.autoStep=!0),this.allSprites._autoUpdate&&this.allSprites.update(),null===this.allSprites._autoUpdate&&(this.allSprites._autoUpdate=!0);for(let t of this.allSprites)t.autoDraw??=!0,t.autoUpdate??=!0;for(let t of["left","center","right"])this.mouse[t]<0?this.mouse[t]=0:this.mouse[t]>0&&this.mouse[t]++,this.world.mouseSprite&&this.world.mouseSprite.mouse[t]<0&&(this.world.mouseSprite.mouse[t]=0);for(let t in this.kb)"holdThreshold"!=t&&(this.kb[t]<0?this.kb[t]=0:this.kb[t]>0&&this.kb[t]++);if(this.world.mouseTracking){if(this.world.mouseSprite){let t=0;for(let e of["left","center","right"])t+=this.world.mouseSprite.mouse[e];0==t&&(this.world.mouseSprite=null)}let t=this.world.getSpritesAt(this.mouse.x,this.mouse.y);t.sort(((t,e)=>-1*(t.layer-e.layer)));let e,i=this.world.getSpritesAt(this.camera.mouse.x,this.camera.mouse.y,this.allSprites,!1);if(i.sort(((t,e)=>-1*(t.layer-e.layer))),t=t.concat(i),this.mouse.pressing("left")||this.mouse.pressing("center")||this.mouse.pressing("right")){if(this.world.mouseSprite?.mouse.draggable)e=this.world.mouseSprite;else for(let i of t)if(i==this.world.mouseSprite){e=i;break}e?(e.mouse.left=this.mouse.left,e.mouse.center=this.mouse.center,e.mouse.right=this.mouse.right,e.mouse.x=e.x-this.mouse.x,e.mouse.y=e.y-this.mouse.y):this.world.mouseSprite&&(this.world.mouseSprite.mouse.left=0,this.world.mouseSprite.mouse.center=0,this.world.mouseSprite.mouse.right=0,this.world.mouseSprite.mouse.draggable=!1)}for(let e of t)e.mouse.hover++;for(let i of this.world.mouseSprites)this.world.mouseSprite?.mouse.draggable&&i==e||t.includes(i)||(i.mouse.hover=-1,i.mouse.left=0,i.mouse.center=0,i.mouse.right=0,i.mouse.draggable=!1);this.world.mouseSprites=t}this.camera.off(),this.p5play._fps&&(this.p5play._postDrawFrameTime=performance.now(),this.p5play._fps=Math.round(1e3/(this.p5play._postDrawFrameTime-this.p5play._preDrawFrameTime))),this.p5play._inPostDraw=!1}));
